import requests
from datetime import datetime, timedelta

# NVD API 설정
NVD_API_URL = 'https://services.nvd.nist.gov/rest/json/cves/1.0'
NVD_API_KEY = 'YOUR_NVD_API_KEY'  # NVD API 키를 입력하세요

def fetch_vulnerabilities():
    # 최근 7일간의 취약점 정보 가져오기
    start_date = (datetime.now() - timedelta(days=7)).strftime('%Y-%m-%dT%H:%M:%S:000 UTC-00:00')
    params = {
        'apiKey': NVD_API_KEY,
        'pubStartDate': start_date
    }
    response = requests.get(NVD_API_URL, params=params)
    data = response.json()
    
    vulnerabilities = []
    for item in data['result']['CVE_Items']:
        cve_id = item['cve']['CVE_data_meta']['ID']
        description = item['cve']['description']['description_data'][0]['value']
        patch_url = item['cve']['references']['reference_data'][0]['url'] if item['cve']['references']['reference_data'] else 'N/A'
        vulnerabilities.append({'cve_id': cve_id, 'description': description, 'patch_url': patch_url})

    return vulnerabilities

def check_for_vulnerabilities(software_list):
    vulnerabilities = fetch_vulnerabilities()
    detected_vulnerabilities = []

    for vulnerability in vulnerabilities:
        for software in software_list:
            if software.lower() in vulnerability['description'].lower():
                detected_vulnerabilities.append(vulnerability)

    return detected_vulnerabilities
